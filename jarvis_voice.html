<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JARVIS AI Voice</title>
<style>
  body {
    background: #050b0b;
    color: #00fff6;
    font-family: Arial, sans-serif;
    text-align: center;
  }
  #chat {
    width: 90%;
    max-width: 500px;
    margin: auto;
  }
  input, button, select {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    background: #001f1f;
    color: #00fff6;
    border: 1px solid #00fff6;
  }
  #messages {
    margin-top: 15px;
    text-align: left;
  }
</style>
</head>

<body>

<h1>JARVIS AI Voice</h1>

<div id="chat">
  <select id="voiceSelect"></select>
  <input id="userInput" placeholder="Type your message..." />
  <button onclick="send()">Send</button>
  <button onclick="startListening()">ðŸŽ¤ Talk to JARVIS</button>
  <div id="status"></div>
  <div id="messages"></div>
</div>

<script>
let voices = [];
let conversation = [];

/* ---------- VOICE SETUP ---------- */
function populateVoices() {
  voices = speechSynthesis.getVoices();
  const select = document.getElementById("voiceSelect");
  select.innerHTML = "";
  voices.forEach((voice, i) => {
    const option = document.createElement("option");
    option.value = i;
    option.textContent = voice.name;
    select.appendChild(option);
  });
}
speechSynthesis.onvoiceschanged = populateVoices;

/* ---------- SPEAK ---------- */
function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);
  const selected = document.getElementById("voiceSelect").value;
  if (voices[selected]) utter.voice = voices[selected];
  utter.rate = 0.95;
  utter.pitch = 0.9;
  speechSynthesis.speak(utter);
}

/* ---------- DISPLAY ---------- */
function display(text, sender = "JARVIS") {
  const div = document.createElement("div");
  div.textContent = sender + ": " + text;
  document.getElementById("messages").appendChild(div);
}

/* ---------- COMMAND ROUTER ---------- */
function jarvisCommandRouter(text) {
  const t = text.toLowerCase();

  if (
    t.includes("can you hear me") ||
    t.includes("are you listening") ||
    t.includes("did you hear me")
  ) {
    return { reply: "Loud and clear, Commander.", local: true };
  }

  if (t.includes("status")) {
    return { reply: "All systems are fully operational.", local: true };
  }

  if (t.includes("hello") || t.includes("hi jarvis")) {
    return { reply: "Hello, Commander. How can I assist you?", local: true };
  }

  return { local: false };
}

/* ---------- SEND ---------- */
function send(textFromVoice = null) {
  const input = document.getElementById("userInput");
  const userText = textFromVoice || input.value;
  if (!userText) return;

  display(userText, "You");
  input.value = "";

  const routed = jarvisCommandRouter(userText);
  if (routed.local) {
    display(routed.reply);
    speak(routed.reply);
    return;
  }

  // fallback response (no backend yet)
  const fallback = "I am processing that request, Commander.";
  display(fallback);
  speak(fallback);
}

/* ---------- VOICE INPUT ---------- */
function startListening() {
  if (!("webkitSpeechRecognition" in window)) {
    alert("Speech recognition not supported");
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.lang = "en-IN";
  recognition.interimResults = false;

  recognition.onstart = () => {
    document.getElementById("status").textContent = "Listening...";
  };

  recognition.onerror = () => {
    document.getElementById("status").textContent = "Voice error";
  };

  recognition.onend = () => {
    document.getElementById("status").textContent = "";
  };

  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript;
    send(text);
  };

  recognition.start();
}
</script>

</body>
</html>