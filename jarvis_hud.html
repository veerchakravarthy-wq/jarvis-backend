<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JARVIS HUD</title>
<style>
body {
  margin:0; padding:0;
  background: radial-gradient(circle at top, #001a1a, #000000);
  color: #00ffe7;
  font-family: 'Arial', sans-serif;
  height: 100vh;
  overflow: hidden;
}
h1 {
  text-align:center;
  margin-top:10px;
  text-shadow: 0 0 10px #00ffe7;
}
#chat {
  max-width: 600px;
  margin: 20px auto;
  padding:10px;
  background: rgba(0,0,0,0.5);
  border: 1px solid #00ffe7;
  border-radius:10px;
  overflow-y:auto;
  height:60vh;
}
.message {
  margin:5px 0;
  padding:8px 12px;
  border-radius:10px;
  max-width:80%;
  word-wrap:break-word;
}
.user {
  background: #002b2b;
  margin-left:auto;
  box-shadow: 0 0 10px #00ffe7;
}
.jarvis {
  background: #004d4d;
  margin-right:auto;
  box-shadow: 0 0 15px #00ffe7;
}
#messages { padding-bottom:10px; }
input, button, select {
  width: 100%;
  padding:12px;
  margin-top:10px;
  background: #001a1a;
  color:#00ffe7;
  border:none;
  font-size:16px;
}
button {
  cursor:pointer;
  background: #00ffe7;
  color: #000;
}
#status {
  color:#888;
  font-size:14px;
  margin-top:5px;
}
.typing {
  display:inline-block;
}
.dot {
  display:inline-block;
  width:6px;
  height:6px;
  margin:0 2px;
  background:#00ffe7;
  border-radius:50%;
  animation: blink 1s infinite;
}
.dot:nth-child(2){animation-delay:0.2s;}
.dot:nth-child(3){animation-delay:0.4s;}
@keyframes blink {
  0%, 80%, 100% {opacity:0;}
  40% {opacity:1;}
}
</style>
</head>
<body>

<h1>JARVIS HUD</h1>

<div id="chat">
  <select id="voiceSelect"></select>
  <input id="userInput" placeholder="Type your message..." />
  <button onclick="send()">Send</button>
  <button onclick="startListening()">ðŸŽ¤ Talk to JARVIS</button>
  <div id="status"></div>
  <div id="messages"></div>
</div>

<script>
let voices=[];
let conversation=[];

function populateVoices(){
  voices = speechSynthesis.getVoices();
  const select = document.getElementById("voiceSelect");
  select.innerHTML="";
  voices.forEach((v,i)=>{
    const option = document.createElement("option");
    option.value=i;
    option.text=v.name + (v.default?" (default)":"");
    select.appendChild(option);
  });
}
speechSynthesis.onvoiceschanged = populateVoices;

// Send typed message
async function send(){
  const userInput=document.getElementById("userInput").value.trim();
  if(!userInput) return;
  processMessage(userInput);
  document.getElementById("userInput").value="";
}

// Process message
async function processMessage(userMessage){
  const messagesDiv=document.getElementById("messages");
  const statusDiv=document.getElementById("status");

  // Show user message
  conversation.push({role:"user", content:userMessage});
  const userMsgDiv=document.createElement("div");
  userMsgDiv.className="message user";
  userMsgDiv.innerText=userMessage;
  messagesDiv.appendChild(userMsgDiv);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;

  // Typing animation
  statusDiv.innerHTML='<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>';

  try{
    const response = await fetch("https://jarvis-backend-7ie0.onrender.com/chat", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:userMessage})
    });
    const data=await response.json();
    const replyText=data.reply || "I am unable to respond right now.";
    conversation.push({role:"jarvis", content:replyText});
    statusDiv.innerHTML="";

    // Show typing animation in chat bubble
    const jarvisMsgDiv=document.createElement("div");
    jarvisMsgDiv.className="message jarvis";
    messagesDiv.appendChild(jarvisMsgDiv);

    let i=0;
    const speed=30;
    const typeWriter=setInterval(()=>{
      jarvisMsgDiv.innerText=replyText.substring(0,i+1);
      i++;
      if(i>=replyText.length) clearInterval(typeWriter);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }, speed);

    // Voice output
    if('speechSynthesis' in window){
      const utterance=new SpeechSynthesisUtterance(replyText);
      const voiceIndex=document.getElementById("voiceSelect").value;
      if(voices[voiceIndex]) utterance.voice=voices[voiceIndex];
      utterance.lang="en-US";
      speechSynthesis.speak(utterance);
    }

  }catch(err){
    statusDiv.innerHTML="";
    const errorDiv=document.createElement("div");
    errorDiv.className="message jarvis";
    errorDiv.innerText="Error connecting to JARVIS.";
    messagesDiv.appendChild(errorDiv);
  }
}

// Voice input
function startListening(){
  const statusDiv=document.getElementById("status");
  if(!('webkitSpeechRecognition' in window)){
    alert("Your browser does not support voice recognition.");
    return;
  }
  const recognition = new webkitSpeechRecognition();
  recognition.lang="en-US";
  recognition.interimResults=false;
  recognition.maxAlternatives=1;
  statusDiv.innerText="Listening...";
  recognition.start();

  recognition.onresult=function(event){
    const transcript=event.results[0][0].transcript;
    statusDiv.innerText="";
    processMessage(transcript);
  };
  recognition.onerror=function(event){
    statusDiv.innerText="";
    alert("Voice recognition error: "+event.error);
  };
}
</script>

</body>
</html>
