<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JARVIS Cinematic AI</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at center, #061a1a, #020606);
  color: #00fff6;
  font-family: Arial, sans-serif;
  text-align: center;
}

h1 { margin-top: 15px; }

#hud {
  width: 90%;
  max-width: 600px;
  margin: 20px auto;
  padding: 15px;
  border: 2px solid #00fff6;
  border-radius: 14px;
  background: rgba(0,0,0,0.6);
  transition: box-shadow 0.3s, border-color 0.3s;
}

#hud.speaking {
  box-shadow: 0 0 25px #ff0033;
  border-color: #ff0033;
}

#hud.listening {
  box-shadow: 0 0 25px #00ff88;
  border-color: #00ff88;
}

#messages {
  height: 280px;
  overflow-y: auto;
  text-align: left;
  padding: 10px;
  border: 1px solid #00fff6;
  border-radius: 8px;
  background: rgba(0,0,0,0.35);
}

.msg { margin-bottom: 6px; }

input, button, select {
  width: 100%;
  margin-top: 10px;
  padding: 10px;
  background: #001818;
  color: #00fff6;
  border: 1px solid #00fff6;
  border-radius: 6px;
  font-size: 15px;
}

#status {
  margin-top: 8px;
  font-size: 14px;
  opacity: 0.85;
}
</style>
</head>

<body>

<h1>JARVIS CINEMATIC HUD</h1>

<div id="hud">
  <select id="voiceSelect"></select>

  <input id="textInput" placeholder="Type a command..." />
  <button onclick="sendText()">Send</button>
  <button onclick="startVoice()">ðŸŽ¤ Tap to Talk</button>

  <div id="status"></div>
  <div id="messages"></div>
</div>

<script>
let voices = [];

/* -------- VOICES -------- */
function loadVoices() {
  voices = speechSynthesis.getVoices();
  const s = document.getElementById("voiceSelect");
  s.innerHTML = "";
  voices.forEach((v,i)=>{
    const o = document.createElement("option");
    o.value=i; o.textContent=v.name;
    s.appendChild(o);
  });
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

/* -------- SPEAK -------- */
function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  const hud = document.getElementById("hud");

  const male = voices.find(v =>
    v.name.toLowerCase().includes("male") ||
    v.name.toLowerCase().includes("david") ||
    v.name.toLowerCase().includes("john")
  );

  u.voice = male || voices[0];
  u.rate = 0.85;
  u.pitch = 0.6;
  u.volume = 1;

  hud.classList.add("speaking");
  u.onend = () => hud.classList.remove("speaking");

  speechSynthesis.speak(u);
}

/* -------- TYPE EFFECT -------- */
function typeReply(text) {
  const box = document.getElementById("messages");
  const div = document.createElement("div");
  div.className = "msg";
  box.appendChild(div);

  let i = 0;
  const timer = setInterval(()=>{
    div.textContent = "JARVIS: " + text.slice(0, i++);
    box.scrollTop = box.scrollHeight;
    if (i > text.length) clearInterval(timer);
  }, 25);
}

/* -------- LOCAL COMMANDS -------- */
function localCmd(t) {
  t = t.toLowerCase();
  if (t.includes("hear me")) return "Loud and clear, Commander.";
  if (t.includes("status")) return "All systems are fully operational.";
  if (t.includes("hello")) return "Hello, Commander. How can I assist you?";
  return null;
}

/* -------- SEND -------- */
function sendText(fromVoice=null) {
  const input = document.getElementById("textInput");
  const text = fromVoice || input.value.trim();
  if (!text) return;

  const box = document.getElementById("messages");
  const u = document.createElement("div");
  u.className="msg";
  u.textContent="You: "+text;
  box.appendChild(u);
  box.scrollTop=box.scrollHeight;
  input.value="";

  const local = localCmd(text);
  if (local) {
    typeReply(local);
    speak(local);
    return;
  }

  document.getElementById("status").textContent="Thinking...";

  fetch("https://jarvis-backend-7ie0.onrender.com/chat", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({message:text})
  })
  .then(r=>r.json())
  .then(d=>{
    const reply = d.reply || "I am unable to respond right now.";
    typeReply(reply);
    speak(reply);
    document.getElementById("status").textContent="";
  })
  .catch(()=>{
    const r="Backend online. Response delayed, Commander.";
    typeReply(r); speak(r);
    document.getElementById("status").textContent="";
  });
}

/* -------- VOICE INPUT -------- */
function startVoice() {
  if (!("webkitSpeechRecognition" in window)) {
    alert("Speech recognition not supported");
    return;
  }

  const hud = document.getElementById("hud");
  const rec = new webkitSpeechRecognition();
  rec.lang="en-IN";
  rec.continuous=false;
  rec.interimResults=false;

  hud.classList.add("listening");
  document.getElementById("status").textContent="Listening...";

  rec.onresult=e=>{
    hud.classList.remove("listening");
    sendText(e.results[0][0].transcript);
  };

  rec.onerror=()=>{
    hud.classList.remove("listening");
    document.getElementById("status").textContent="Voice error";
  };

  rec.onend=()=>{
    hud.classList.remove("listening");
    document.getElementById("status").textContent="";
  };

  rec.start();
}
</script>

</body>
</html>