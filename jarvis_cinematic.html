<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JARVIS AI Cinematic</title>
<style>
  body {
    background: #050b0b;
    color: #00fff6;
    font-family: Arial, sans-serif;
    text-align: center;
    overflow: hidden;
  }
  #hud-container {
    width: 90%;
    max-width: 600px;
    margin: 20px auto;
    border: 1px solid #00fff6;
    padding: 15px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.5);
  }
  #messages {
    height: 300px;
    overflow-y: auto;
    text-align: left;
    margin-top: 10px;
    padding: 5px;
    border: 1px solid #00fff6;
    border-radius: 5px;
    background: rgba(0,0,0,0.3);
  }
  input, button, select {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    background: #001f1f;
    color: #00fff6;
    border: 1px solid #00fff6;
    border-radius: 5px;
  }
</style>
</head>

<body>
<h1>JARVIS Cinematic HUD</h1>

<div id="hud-container">
  <select id="voiceSelect"></select>
  <input id="userInput" placeholder="Type your message..." />
  <button onclick="send()">Send</button>
  <button onclick="startListening()">ðŸŽ¤ Talk to JARVIS</button>
  <div id="status"></div>
  <div id="messages"></div>
</div>

<script>
let voices = [];

/* ---------- VOICE SETUP ---------- */
function populateVoices() {
  voices = speechSynthesis.getVoices();
  const select = document.getElementById("voiceSelect");
  select.innerHTML = "";
  voices.forEach((voice, i) => {
    const option = document.createElement("option");
    option.value = i;
    option.textContent = voice.name;
    select.appendChild(option);
  });
}
speechSynthesis.onvoiceschanged = populateVoices;

/* ---------- SPEAK FUNCTION WITH STRONG MALE VOICE ---------- */
function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);

  // Auto-select a deep male voice if available
  const maleVoice = voices.find(v =>
    v.name.toLowerCase().includes("male") ||
    v.name.toLowerCase().includes("david") ||
    v.name.toLowerCase().includes("john")
  );
  if (maleVoice) {
    utter.voice = maleVoice;
  } else if (voices[0]) {
    utter.voice = voices[0]; // fallback
  }

  utter.rate = 0.85;  // slightly slower
  utter.pitch = 0.6;  // deeper tone
  utter.volume = 1.0;

  // HUD pulse effect while speaking
  const hud = document.getElementById("hud-container");
  hud.style.borderColor = "#ff0000"; // pulse red
  utter.onend = () => {
    hud.style.borderColor = "#00fff6"; // reset
  };

  speechSynthesis.speak(utter);
}

/* ---------- DISPLAY MESSAGES ---------- */
function display(text, sender = "JARVIS") {
  const div = document.createElement("div");
  div.textContent = sender + ": " + text;
  document.getElementById("messages").appendChild(div);
  document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
}

/* ---------- COMMAND ROUTER ---------- */
function jarvisCommandRouter(text) {
  const t = text.toLowerCase();

  if (
    t.includes("can you hear me") ||
    t.includes("are you listening") ||
    t.includes("did you hear me")
  ) {
    return { reply: "Loud and clear, Commander.", local: true };
  }

  if (t.includes("status")) {
    return { reply: "All systems are fully operational.", local: true };
  }

  if (t.includes("hello") || t.includes("hi jarvis")) {
    return { reply: "Hello, Commander. How can I assist you?", local: true };
  }

  return { local: false };
}

/* ---------- SEND FUNCTION ---------- */
function send(textFromVoice = null) {
  const input = document.getElementById("userInput");
  const userText = textFromVoice || input.value;
  if (!userText) return;

  display(userText, "You");
  input.value = "";

  const routed = jarvisCommandRouter(userText);
  if (routed.local) {
    display(routed.reply);
    speak(routed.reply);
    return;
  }

  const fallback = "I am processing that request, Commander.";
  display(fallback);
  speak(fallback);
}

/* ---------- WAKE-WORD LISTENING ---------- */
function startListening() {
  if (!("webkitSpeechRecognition" in window)) {
    alert("Speech recognition not supported");
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.lang = "en-IN";
  recognition.interimResults = false;
  recognition.continuous = true;

  document.getElementById("status").textContent = "Wake-word listening...";

  recognition.onresult = (event) => {
    const text = event.results[event.results.length - 1][0].transcript.trim();
    console.log("Heard:", text);

    // Wake-word detection
    if (/hey jarvis/i.test(text)) {
      document.getElementById("status").textContent = "Activated! Listening command...";
      speak("Yes, Commander?");
      recognition.stop();
      listenForCommand();
    }
  };

  recognition.onerror = () => {
    document.getElementById("status").textContent = "Voice error";
  };

  recognition.onend = () => {
    recognition.start(); // resume wake-word listening
  };

  recognition.start();
}

/* ---------- LISTEN FOR COMMAND AFTER WAKE-WORD ---------- */
function listenForCommand() {
  const cmdRecog = new webkitSpeechRecognition();
  cmdRecog.lang = "en-IN";
  cmdRecog.interimResults = false;

  cmdRecog.onstart = () => {
    document.getElementById("status").textContent = "Listening for command...";
  };

  cmdRecog.onresult = (event) => {
    const commandText = event.results[0][0].transcript.trim();
    send(commandText);
  };

  cmdRecog.onerror = () => {
    document.getElementById("status").textContent = "Command voice error";
  };

  cmdRecog.onend = () => {
    document.getElementById("status").textContent = "Wake-word listening...";
    startListening();
  };

  cmdRecog.start();
}

// Automatically populate voices on load
populateVoices();
</script>

</body>
</html>