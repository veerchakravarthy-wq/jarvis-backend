<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JARVIS Cinematic AI</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at center, #061a1a, #020606);
  color: #00fff6;
  font-family: Arial, sans-serif;
  text-align: center;
}

h1 { margin-top: 15px; }

#hud {
  width: 90%;
  max-width: 600px;
  margin: 20px auto;
  padding: 15px;
  border: 2px solid #00fff6;
  border-radius: 14px;
  background: rgba(0,0,0,0.6);
  transition: box-shadow 0.3s, border-color 0.3s;
}

#hud.speaking { box-shadow: 0 0 25px #ff0033; border-color:#ff0033; }
#hud.listening { box-shadow: 0 0 25px #00ff88; border-color:#00ff88; }

#messages {
  height: 280px;
  overflow-y: auto;
  text-align: left;
  padding: 10px;
  border: 1px solid #00fff6;
  border-radius: 8px;
  background: rgba(0,0,0,0.35);
}

.msg { margin-bottom: 6px; }

input, button {
  width: 100%;
  margin-top: 10px;
  padding: 10px;
  background: #001818;
  color: #00fff6;
  border: 1px solid #00fff6;
  border-radius: 6px;
  font-size: 15px;
}

#status {
  margin-top: 8px;
  font-size: 14px;
  opacity: 0.85;
}
</style>
</head>

<body>

<h1>JARVIS CINEMATIC HUD</h1>

<div id="hud">
  <input id="textInput" placeholder="Awaiting command..." />
  <button onclick="sendText()">Send Command</button>
  <button onclick="startVoice()">ðŸŽ¤ Voice Command</button>
  <div id="status"></div>
  <div id="messages"></div>
</div>

<script>
/* ================= CORE STATE ================= */
let MODE = "ASSISTANT";
let USER_TITLE = "Commander";

/* ================= VOICE ================= */
let voices=[];
speechSynthesis.onvoiceschanged=()=>{
  voices=speechSynthesis.getVoices();
};

function speak(text){
  const u=new SpeechSynthesisUtterance(text);
  const hud=document.getElementById("hud");

  const male=voices.find(v =>
    v.name.toLowerCase().includes("male") ||
    v.name.toLowerCase().includes("david") ||
    v.name.toLowerCase().includes("john")
  );

  u.voice=male||voices[0];
  u.rate=0.85;
  u.pitch=0.6;

  hud.classList.add("speaking");
  u.onend=()=>hud.classList.remove("speaking");

  speechSynthesis.speak(u);
}

/* ================= UI ================= */
function addMsg(text,who){
  const d=document.createElement("div");
  d.className="msg";
  d.textContent=who+": "+text;
  const box=document.getElementById("messages");
  box.appendChild(d);
  box.scrollTop=box.scrollHeight;
}

/* ================= TYPE EFFECT ================= */
function typeJarvis(text){
  const box=document.getElementById("messages");
  const d=document.createElement("div");
  d.className="msg";
  box.appendChild(d);

  let i=0;
  const t=setInterval(()=>{
    d.textContent="JARVIS: "+text.slice(0,i++);
    box.scrollTop=box.scrollHeight;
    if(i>text.length) clearInterval(t);
  },25);
}

/* ================= COMMAND INTELLIGENCE ================= */
function commandRouter(text){
  const t=text.toLowerCase();

  if(t.includes("status")){
    return `All systems are operational, ${USER_TITLE}.`;
  }

  if(t.includes("assistant mode")){
    MODE="ASSISTANT";
    return "Assistant mode engaged.";
  }

  if(t.includes("analysis mode")){
    MODE="ANALYSIS";
    return "Analysis mode activated. Awaiting data.";
  }

  if(t.includes("standby")){
    MODE="STANDBY";
    return "Entering standby mode. Monitoring quietly.";
  }

  if(t.includes("can you hear me")){
    return `Loud and clear, ${USER_TITLE}.`;
  }

  if(t.includes("who are you")){
    return `I am JARVIS, your personal AI system.`;
  }

  return null;
}

/* ================= SEND ================= */
function sendText(fromVoice=null){
  const input=document.getElementById("textInput");
  const text=fromVoice||input.value.trim();
  if(!text) return;

  addMsg(text,"You");
  input.value="";

  const local=commandRouter(text);
  if(local){
    typeJarvis(local);
    speak(local);
    return;
  }

  document.getElementById("status").textContent="Processing...";

  fetch("https://jarvis-backend-7ie0.onrender.com/chat",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      message:`You are JARVIS in ${MODE} mode. Reply formally. User is Commander. Question: ${text}`
    })
  })
  .then(r=>r.json())
  .then(d=>{
    const reply=d.reply||"I am unable to respond right now.";
    typeJarvis(reply);
    speak(reply);
    document.getElementById("status").textContent="";
  })
  .catch(()=>{
    const r="Backend delay detected. Standing by.";
    typeJarvis(r);
    speak(r);
    document.getElementById("status").textContent="";
  });
}

/* ================= VOICE INPUT ================= */
function startVoice(){
  if(!("webkitSpeechRecognition"in window)){
    alert("Speech recognition not supported");
    return;
  }

  const hud=document.getElementById("hud");
  const r=new webkitSpeechRecognition();
  r.lang="en-IN";
  r.continuous=false;

  hud.classList.add("listening");
  document.getElementById("status").textContent="Listening...";

  r.onresult=e=>{
    hud.classList.remove("listening");
    sendText(e.results[0][0].transcript);
  };

  r.onerror=()=>{
    hud.classList.remove("listening");
    document.getElementById("status").textContent="Voice error";
  };

  r.onend=()=>{
    hud.classList.remove("listening");
    document.getElementById("status").textContent="";
  };

  r.start();
}
</script>

</body>
</html>