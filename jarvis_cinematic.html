<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JARVIS Cinematic AI</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at center, #061a1a, #020606);
  color: #00fff6;
  font-family: Arial, sans-serif;
  text-align: center;
}

h1 {
  margin-top: 15px;
}

#hud {
  width: 90%;
  max-width: 600px;
  margin: 20px auto;
  padding: 15px;
  border: 2px solid #00fff6;
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.55);
}

#messages {
  height: 280px;
  overflow-y: auto;
  text-align: left;
  padding: 10px;
  border: 1px solid #00fff6;
  border-radius: 8px;
  background: rgba(0,0,0,0.35);
}

.msg {
  margin-bottom: 6px;
}

input, button, select {
  width: 100%;
  margin-top: 10px;
  padding: 10px;
  background: #001818;
  color: #00fff6;
  border: 1px solid #00fff6;
  border-radius: 6px;
  font-size: 15px;
}

#status {
  margin-top: 8px;
  font-size: 14px;
  opacity: 0.85;
}
</style>
</head>

<body>

<h1>JARVIS CINEMATIC HUD</h1>

<div id="hud">
  <select id="voiceSelect"></select>

  <input id="textInput" placeholder="Type a command..." />
  <button onclick="sendText()">Send</button>
  <button onclick="startVoice()">ðŸŽ¤ Tap to Talk</button>

  <div id="status"></div>
  <div id="messages"></div>
</div>

<script>
/* ================== VOICE SETUP ================== */
let voices = [];

function loadVoices() {
  voices = speechSynthesis.getVoices();
  const select = document.getElementById("voiceSelect");
  select.innerHTML = "";
  voices.forEach((v, i) => {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = v.name;
    select.appendChild(opt);
  });
}
speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

/* ================== SPEAK ================== */
function speak(text) {
  const u = new SpeechSynthesisUtterance(text);

  const male = voices.find(v =>
    v.name.toLowerCase().includes("male") ||
    v.name.toLowerCase().includes("david") ||
    v.name.toLowerCase().includes("john")
  );

  u.voice = male || voices[0];
  u.rate = 0.85;
  u.pitch = 0.6;
  u.volume = 1;

  const hud = document.getElementById("hud");
  hud.style.borderColor = "#ff0033";
  u.onend = () => hud.style.borderColor = "#00fff6";

  speechSynthesis.speak(u);
}

/* ================== UI ================== */
function addMsg(text, who) {
  const d = document.createElement("div");
  d.className = "msg";
  d.textContent = who + ": " + text;
  document.getElementById("messages").appendChild(d);
  document.getElementById("messages").scrollTop = 99999;
}

/* ================== LOCAL COMMANDS ================== */
function localCommand(text) {
  const t = text.toLowerCase();

  if (t.includes("can you hear me") || t.includes("are you listening")) {
    return "Loud and clear, Commander.";
  }

  if (t.includes("status")) {
    return "All systems are fully operational.";
  }

  if (t.includes("hello") || t.includes("hi jarvis")) {
    return "Hello, Commander. How can I assist you?";
  }

  return null;
}

/* ================== SEND TEXT ================== */
function sendText(fromVoice = null) {
  const input = document.getElementById("textInput");
  const text = fromVoice || input.value.trim();
  if (!text) return;

  addMsg(text, "You");
  input.value = "";

  const local = localCommand(text);
  if (local) {
    addMsg(local, "JARVIS");
    speak(local);
    return;
  }

  // ===== BACKEND CALL =====
  fetch("https://jarvis-backend-7ie0.onrender.com/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: text })
  })
  .then(r => r.json())
  .then(d => {
    const reply = d.reply || "I am unable to respond right now.";
    addMsg(reply, "JARVIS");
    speak(reply);
  })
  .catch(() => {
    addMsg("Backend online. Response delayed, Commander.", "JARVIS");
    speak("Backend online. Response delayed, Commander.");
  });
}

/* ================== VOICE INPUT ================== */
function startVoice() {
  if (!("webkitSpeechRecognition" in window)) {
    alert("Speech recognition not supported");
    return;
  }

  const rec = new webkitSpeechRecognition();
  rec.lang = "en-IN";
  rec.interimResults = false;
  rec.continuous = false;

  document.getElementById("status").textContent = "Listening...";

  rec.onresult = e => {
    const text = e.results[0][0].transcript;
    sendText(text);
  };

  rec.onerror = () => {
    document.getElementById("status").textContent = "Voice error. Tap again.";
  };

  rec.onend = () => {
    document.getElementById("status").textContent = "";
  };

  rec.start();
}
</script>

</body>
</html>