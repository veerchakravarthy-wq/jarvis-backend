<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JARVIS AI Cinematic</title>
<style>
  body {
    background: #050b0b;
    color: #00fff6;
    font-family: Arial, sans-serif;
    text-align: center;
    overflow: hidden;
  }
  #hud-container {
    width: 90%;
    max-width: 600px;
    margin: 20px auto;
    border: 1px solid #00fff6;
    padding: 15px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.5);
  }
  #messages {
    height: 300px;
    overflow-y: auto;
    text-align: left;
    margin-top: 10px;
    padding: 5px;
    border: 1px solid #00fff6;
    border-radius: 5px;
    background: rgba(0,0,0,0.3);
  }
  input, button, select {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    background: #001f1f;
    color: #00fff6;
    border: 1px solid #00fff6;
    border-radius: 5px;
  }
</style>
</head>

<body>
<h1>JARVIS Cinematic HUD</h1>

<div id="hud-container">
  <select id="voiceSelect"></select>
  <input id="userInput" placeholder="Type your message..." />
  <button onclick="send()">Send</button>
  <button onclick="tapToTalk()">ðŸŽ¤ Tap to Talk</button>
  <div id="status"></div>
  <div id="messages"></div>
</div>

<script>
let voices = [];

/* ---------- VOICE SETUP ---------- */
function populateVoices() {
  voices = speechSynthesis.getVoices();
  const select = document.getElementById("voiceSelect");
  select.innerHTML = "";
  voices.forEach((voice, i) => {
    const option = document.createElement("option");
    option.value = i;
    option.textContent = voice.name;
    select.appendChild(option);
  });
}
speechSynthesis.onvoiceschanged = populateVoices;

/* ---------- STRONG MALE SPEAK FUNCTION ---------- */
function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);

  const maleVoice = voices.find(v =>
    v.name.toLowerCase().includes("male") ||
    v.name.toLowerCase().includes("david") ||
    v.name.toLowerCase().includes("john")
  );
  if (maleVoice) {
    utter.voice = maleVoice;
  } else if (voices[0]) {
    utter.voice = voices[0];
  }

  utter.rate = 0.85;
  utter.pitch = 0.6;
  utter.volume = 1.0;

  const hud = document.getElementById("hud-container");
  hud.style.borderColor = "#ff0000";
  utter.onend = () => {
    hud.style.borderColor = "#00fff6";
  };

  speechSynthesis.speak(utter);
}

/* ---------- DISPLAY ---------- */
function display(text, sender = "JARVIS") {
  const div = document.createElement("div");
  div.textContent = sender + ": " + text;
  document.getElementById("messages").appendChild(div);
  document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
}

/* ---------- COMMAND ROUTER ---------- */
function jarvisCommandRouter(text) {
  const t = text.toLowerCase();

  if (
    t.includes("can you hear me") ||
    t.includes("are you listening") ||
    t.includes("did you hear me")
  ) {
    return { reply: "Loud and clear, Commander.", local: true };
  }

  if (t.includes("status")) {
    return { reply: "All systems are fully operational.", local: true };
  }

  if (t.includes("hello") || t.includes("hi jarvis")) {
    return { reply: "Hello, Commander. How can I assist you?", local: true };
  }

  return { local: false };
}

/* ---------- SEND ---------- */
function send(textFromVoice = null) {
  const input = document.getElementById("userInput");
  const userText = textFromVoice || input.value;
  if (!userText) return;

  display(userText, "You");
  input.value = "";

  const routed = jarvisCommandRouter(userText);
  if (routed.local) {
    display(routed.reply);
    speak(routed.reply);
    return;
  }

  // ---------- BACKEND GPT CALL ----------
  fetch("https://<your-render-backend>.onrender.com/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: userText })
  })
  .then(res => res.json())
  .then(data => {
    display(data.reply);
    speak(data.reply);
  })
  .catch(() => {
    display("I am unable to respond right now.");
    speak("I am unable to respond right now.");
  });
}

/* ---------- TAP-TO-TALK ---------- */
function tapToTalk() {
  if (!("webkitSpeechRecognition" in window)) {
    alert("Speech recognition not supported");
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.lang = "en-IN";
  recognition.interimResults = false;
  recognition.continuous = false;

  document.getElementById("status").textContent = "Listening...";

  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript.trim();
    send(text);
  };

  recognition.onerror = () => {
    document.getElementById("status").textContent = "Voice error. Tap again.";
  };

  recognition.onend = () => {
    document.getElementById("status").textContent = "";
  };

  recognition.start();
}

// Populate voices on load
populateVoices();
</script>

</body>
</html>